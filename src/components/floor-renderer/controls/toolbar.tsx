'use client';

import { Button } from '@/components/ui/button';
import { useEffect, useState } from 'react';
import { useCanvasState } from '../contexts/canvas-state-context';

interface ToolbarProps {
  hidden?: boolean;
}

function Toolbar({ hidden = false }: ToolbarProps) {
  const { viewMode, toggleViewMode } = useCanvasState();
  const [shown, setShown] = useState(!hidden);
  const [visible, setVisible] = useState(false);

  useEffect(() => {
    if (!hidden) {
      setShown(true);
    }
  }, [hidden]);

  useEffect(() => {
    if (shown && !hidden) {
      const id = setTimeout(() => setVisible(true), 10);
      return () => clearTimeout(id);
    } else {
      setVisible(false);
      const timeout = setTimeout(() => setShown(false), 300);
      return () => clearTimeout(timeout);
    }
  }, [hidden, shown]);

  if (!shown) return null;

  return (
    <nav
      aria-label="Control selector"
      className={`absolute bottom-6 bg-white left-1/2 -translate-x-1/2 shadow-2xl rounded-xl
        transition-all translate-y-1/2 opacity-0 ${
          visible ? 'opacity-100 !translate-y-0' : ''
        }`}
    >
      <ul className="h-14 flex items-center justify-center gap-3 px-2 *:[li]:py-2">
        <li>
          <Button
            aria-label="Selection mode"
            size="icon-lg"
            variant="ghost"
            className="cursor-pointer *:[svg]:!w-5 *:[svg]:!h-5"
            onClick={() => toggleViewMode()}
          >
            {viewMode === '3d' ? (
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M13.1111 15.3333H16.4444C17.0555 15.3333 17.5789 15.1159 18.0144 14.6811C18.45 14.2463 18.6674 13.723 18.6666 13.1111V10.8889C18.6666 10.2778 18.4492 9.75482 18.0144 9.32001C17.5796 8.88519 17.0563 8.66741 16.4444 8.66667H13.1111V15.3333ZM14.7778 13.6667V10.3333H16.4444C16.5926 10.3333 16.7222 10.3889 16.8333 10.5C16.9444 10.6111 17 10.7407 17 10.8889V13.1111C17 13.2593 16.9444 13.3889 16.8333 13.5C16.7222 13.6111 16.5926 13.6667 16.4444 13.6667H14.7778ZM9.77776 15.3333C10.0926 15.3333 10.3566 15.2267 10.57 15.0133C10.7833 14.8 10.8896 14.5363 10.8889 14.2222V13.1111C10.8889 12.7963 10.7822 12.5326 10.5689 12.32C10.3555 12.1074 10.0918 12.0007 9.77776 12C10.0926 12 10.3566 11.8933 10.57 11.68C10.7833 11.4667 10.8896 11.203 10.8889 10.8889V9.77778C10.8889 9.46297 10.7822 9.19926 10.5689 8.98667C10.3555 8.77408 10.0918 8.66741 9.77776 8.66667H6.7222C6.48146 8.66667 6.28257 8.74556 6.12554 8.90334C5.9685 9.06112 5.88961 9.26 5.88887 9.5C5.88813 9.74 5.96702 9.93926 6.12554 10.0978C6.28405 10.2563 6.48294 10.3348 6.7222 10.3333H9.2222V11.1667H7.83332C7.59258 11.1667 7.39369 11.2456 7.23665 11.4033C7.07961 11.5611 7.00072 11.76 6.99998 12C6.99924 12.24 7.07813 12.4393 7.23665 12.5978C7.39517 12.7563 7.59406 12.8348 7.83332 12.8333H9.2222V13.6667H6.7222C6.48146 13.6667 6.28257 13.7456 6.12554 13.9033C5.9685 14.0611 5.88961 14.26 5.88887 14.5C5.88813 14.74 5.96702 14.9393 6.12554 15.0978C6.28405 15.2563 6.48294 15.3348 6.7222 15.3333H9.77776ZM4.22222 22C3.61111 22 3.08815 21.7826 2.65333 21.3478C2.21852 20.913 2.00074 20.3896 2 19.7778V4.22222C2 3.61111 2.21778 3.08815 2.65333 2.65333C3.08889 2.21852 3.61185 2.00074 4.22222 2H19.8744C20.4856 2 21.0089 2.21778 21.4444 2.65333C21.88 3.08889 22.0974 3.61185 22.0967 4.22222V19.7778C22.0967 20.3889 21.8793 20.9122 21.4444 21.3478C21.0096 21.7833 20.4863 22.0007 19.8744 22H4.22222ZM4.22222 19.7778H19.8744V4.22222H4.22222V19.7778Z"
                  fill="currentColor"
                />
              </svg>
            ) : (
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M5.88889 15.3333H10.8889V13.6667H7.55556V12.5556H9.77778C10.0926 12.5556 10.3567 12.4489 10.57 12.2356C10.7833 12.0222 10.8896 11.7585 10.8889 11.4444V9.77778C10.8889 9.46296 10.7822 9.19926 10.5689 8.98667C10.3556 8.77407 10.0919 8.66741 9.77778 8.66667H5.88889V10.3333H9.22222V11.4444H7C6.68518 11.4444 6.42148 11.5511 6.20889 11.7644C5.9963 11.9778 5.88963 12.2415 5.88889 12.5556V15.3333ZM13.1111 15.3333H17.5556C17.8704 15.3333 18.1344 15.2267 18.3478 15.0133C18.5611 14.8 18.6674 14.5363 18.6667 14.2222V9.77778C18.6667 9.46296 18.56 9.19926 18.3467 8.98667C18.1333 8.77407 17.8696 8.66741 17.5556 8.66667H13.1111V15.3333ZM14.7778 13.6667V10.3333H17V13.6667H14.7778ZM4.22222 22C3.61111 22 3.08815 21.7826 2.65333 21.3478C2.21852 20.913 2.00074 20.3896 2 19.7778V4.22222C2 3.61111 2.21778 3.08815 2.65333 2.65333C3.08889 2.21852 3.61185 2.00074 4.22222 2H19.7778C20.3889 2 20.9122 2.21778 21.3478 2.65333C21.7833 3.08889 22.0007 3.61185 22 4.22222V19.7778C22 20.3889 21.7826 20.9122 21.3478 21.3478C20.913 21.7833 20.3896 22.0007 19.7778 22H4.22222ZM4.22222 19.7778H19.7778V4.22222H4.22222V19.7778Z"
                  fill="currentColor"
                />
              </svg>
            )}
          </Button>
        </li>
      </ul>
    </nav>
  );
}

export default Toolbar;
